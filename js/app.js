window.windgazer=window.windgazer===void 0?{}:window.windgazer;var GUIBuilder=function(){function e(e,t,n){e.on(n,function(e){t.trigger(n,e)})}function t(){this.counters=[]}function n(e,t){return 4..toString(2).substr(1,t-(""+e).length)+e}function i(e){var t=e.appendChild(document.createElement("thead")).appendChild(document.createElement("tr"));t.appendChild(document.createElement("th")).appendChild(document.createTextNode(""));for(var n=0;u.length>n;n++){var i=u[n],r=t.appendChild(document.createElement("td"));r.setAttribute("colspan",2),r.appendChild(document.createTextNode(i.title))}}function r(e){var t=n(e.time.getHours(),2)+":"+n(e.time.getMinutes(),2)+":"+n(e.time.getSeconds(),2),i=e.content,r=!1,o=document.createElement("tr");o.appendChild(document.createElement("th")).appendChild(document.createTextNode(t));for(var a=0;u.length>a;a++){var s=u[a],c=!1,l=!1;s.title==i[2]&&(c=i[0],l=i[1],r=!0),o.appendChild(document.createElement("td")).appendChild(document.createTextNode(c===!1?"":c)),o.appendChild(document.createElement("td")).appendChild(document.createTextNode(l===!1?"":l))}if(!r){var d=o.appendChild(document.createElement("td"));d.className="free",d.appendChild(document.createTextNode(i[0]))}return o}function o(e){var t=document.querySelector("#log table"),n=r(e),o=document.querySelector("#log tbody");o||(i(t),o=t.appendChild(document.createElement("tbody"))),o&&o.insertBefore(n,o.firstChild)}var a="content",s=a,u="undefined"==typeof nl_windgazer_template?"":nl_windgazer_template;dblclick=!1,startHash=document.location.hash,logStash=[],t.prototype={render:function(){var t=[];this.counters=[],this.trigger("gui.render",{src:this});var n=document.getElementById(s);if(n){n.innerHTML="",dblclick===!1&&(dblclick=Events.attach(n,"dblclick",function(e){return Events.cancel(e||Event)}),Events.attach(n,"selectstart",function(e){return Events.cancel(e||Event)}));for(var i=0;u.length>i;i++){var r=u[i],o=windgazer.ALCounterHelper.getType(r.type),a=new RSVP.Promise,c=new o({title:r.title,value:r.value});e(c,this,"counter.modified"),c.renderTemplate().then(function(e){n.appendChild(e.node),a.resolve({node:e.node})}),this.counters.push(c),t.push(a)}n.className=n.className.replace(/ ?counters_./gi,""),n.className+=" counters_"+u.length}return RSVP.all(t)},setRoot:function(e){s=e},getRoot:function(){return s},setTemplate:function(e){u=e},getTemplate:function(){return u},getCounters:function(){return this.counters}},RSVP.EventTarget.mixin(t.prototype),LinkListener.addHandler("reset",function(){return c.render(),!0}),LinkListener.addHandler("dialogEnd",function(e){return document.location.hash!==startHash?(history.back(1),!1):(document.location.replace(e.href),startHash=document.location.hash,!1)});var c=new t;return c.on("log.modified",function(e){var t=document.querySelector("#log table"),n=e.data;if(t){for(var i=null;i=logStash.shift();)o(i);o(n)}else logStash.push(n)}),Events.attach(window,"load",function(){c.render()}),c}(windgazer);window.windgazer=window.windgazer===void 0?{}:window.windgazer;var GameLog=function(e){function t(){var t=e.counters[s];try{o.log(u,t.getValue(),t.getTitle())}catch(n){console&&console.error(n)}s=null,u=0,a=!1}function n(e,t,n){e.on(n,function(e){t.trigger(n,e),GUIBuilder.trigger(n,e)})}function i(){n(o,this,"log.modified")}var r=Class.extend({init:function(){this.logs=[],this.log("Start")},log:function(){var e=new Date,t={time:e,content:arguments};this.logs.push(t),this.trigger("log.modified",{data:t})},toString:function(){for(var e="",t=0;this.logs.length>t;t++){var n=this.logs[t];e+=n.time.toTimeString(),e+=": ";for(var i=0;n.content.length>i;i++)i>0&&(e+=" "),e+=JSON.stringify(n.content[i]);e+="\n"}return e}});RSVP.EventTarget.mixin(r.prototype);var o=new r,a=!1,s=null,u=0;return GUIBuilder.on("gui.render",function(){o.log("New Game")}),GUIBuilder.on("counter.modified",function(e){a&&(window.clearTimeout(a),s==e.id?u+=e.inc:t()),null===s&&(s=e.id,u=e.inc),a=window.setTimeout(t,3e3)}),i.prototype={getLog:function(){return""+o},clearLog:function(){o=new r,n(o,this,"log.modified")}},RSVP.EventTarget.mixin(i.prototype),new i}(windgazer);