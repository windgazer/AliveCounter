window.windgazer=window.windgazer===void 0?{}:window.windgazer;var GUIBuilder=function(){function e(e,t,n){e.on(n,function(e){t.trigger(n,e)})}function t(){this.counters=[]}function n(e,t){return 4..toString(2).substr(1,t-(""+e).length)+e}function r(e){var t=e.appendChild(document.createElement("thead")).appendChild(document.createElement("tr"));t.appendChild(document.createElement("th")).appendChild(document.createTextNode(""));for(var n=0;s.length>n;n++){var r=s[n],i=t.appendChild(document.createElement("td"));i.setAttribute("colspan",2),i.appendChild(document.createTextNode(r.title))}}function i(e){var t,n=[];for(3>e.length&&(n=e);e.length>=3;)t=e.splice(0,3),n[t[2]]=t;return n}function o(e){var t=n(e.time.getHours(),2)+":"+n(e.time.getMinutes(),2)+":"+n(e.time.getSeconds(),2),r=e.content,o=i(r),a=document.createElement("tr");a.appendChild(document.createElement("th")).appendChild(document.createTextNode(t));for(var u=0;s.length>u;u++){var c=s[u],l=!1,d=!1;o[c.title]&&(l=o[c.title][0],d=o[c.title][1]),a.appendChild(document.createElement("td")).appendChild(document.createTextNode(l===!1?"":l)),a.appendChild(document.createElement("td")).appendChild(document.createTextNode(d===!1?"":d))}if(o.length>0){var f=a.appendChild(document.createElement("td"));f.className="free",f.appendChild(document.createTextNode(r[0]))}return a}function a(e){var t=document.querySelector("#log table"),n=o(e),i=document.querySelector("#log tbody");i||(r(t),i=t.appendChild(document.createElement("tbody"))),i&&i.insertBefore(n,i.firstChild)}var u="content",c=u,s="undefined"==typeof nl_windgazer_template?"":nl_windgazer_template;dblclick=!1,startHash=document.location.hash,logStash=[],t.prototype={render:function(){var t=[];this.counters=[],this.trigger("gui.render",{src:this});var n=document.getElementById(c);if(n){n.innerHTML="",dblclick===!1&&(dblclick=Events.attach(n,"dblclick",function(e){return Events.cancel(e||Event)}),Events.attach(n,"selectstart",function(e){return Events.cancel(e||Event)}));for(var r=0;s.length>r;r++){var i=s[r],o=windgazer.ALCounterHelper.getType(i.type),a=new RSVP.Promise,u=new o({title:i.title,value:i.value});e(u,this,"counter.modified"),u.renderTemplate().then(function(e){n.appendChild(e.node),a.resolve({node:e.node})}),this.counters.push(u),t.push(a)}n.className=n.className.replace(/ ?counters_./gi,""),n.className+=" counters_"+s.length}return RSVP.all(t)},setRoot:function(e){c=e},getRoot:function(){return c},setTemplate:function(e){s=e},getTemplate:function(){return s},getCounters:function(){return this.counters}},RSVP.EventTarget.mixin(t.prototype),FastButtonListener.addHandler("reset",function(){return l.render(),!0}),FastButtonListener.addHandler("dialogEnd",function(e){return document.location.hash!==startHash?(history.back(1),!1):(e.href?document.location.replace(e.href):document.location.replace("#"+e.target.id),Interactions.clear(),startHash=document.location.hash,!1)});var l=new t;return l.on("log.modified",function(e){var t=document.querySelector("#log table"),n=e.data;if(t){for(var r=null;r=logStash.shift();)a(r);a(n)}else logStash.push(n)}),Events.attach(window,"load",function(){l.render()}),l}(windgazer);window.windgazer=window.windgazer===void 0?{}:window.windgazer;var GameLog=function(e){function t(){c&&window.clearTimeout(c),c=!1;var t,n=[];for(t in a){var r=t,i=a[r],o=e.counters[r];n[n.length]=i.mod,n[n.length]=o.getValue(),n[n.length]=o.getTitle()}try{u.log.apply(u,n)}catch(s){console&&console.error(n)}a={}}function n(e){c&&window.clearTimeout(c),c=window.setTimeout(t,2e3);var n=e.id,r=a[n]?a[n]:{id:n,mod:0};r.mod+=e.inc,a[n]=r}function r(e,t,n){e.on(n,function(e){t.trigger(n,e),GUIBuilder.trigger(n,e)})}function i(){r(u,this,"log.modified")}var o=Class.extend({init:function(){this.logs=[],this.log("Start")},log:function(){var e=new Date,t=[];t.push.apply(t,arguments);var n={time:e,content:t};this.logs.push(n),this.trigger("log.modified",{data:n})},toString:function(){for(var e="",t=0;this.logs.length>t;t++){var n=this.logs[t];e+=n.time.toTimeString(),e+=": ";for(var r=0;n.content.length>r;r++)r>0&&(e+=" "),e+=JSON.stringify(n.content[r]);e+="\n"}return e}});RSVP.EventTarget.mixin(o.prototype);var a={},u=new o,c=!1;return GUIBuilder.on("gui.render",function(){t(),u.log("New Game")}),GUIBuilder.on("counter.modified",n),i.prototype={getLog:function(){return""+u},clearLog:function(){u=new o,r(u,this,"log.modified")}},RSVP.EventTarget.mixin(i.prototype),new i}(windgazer);